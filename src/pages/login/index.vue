<!--  -->
<template>
  <div class="login-wrap">
    <div class="login-top">
      <span class="logo">LOGO </span>
      <span class="title"> 用AI助力企业增长</span>
    </div>
    <svg width="1361px" height="609px" viewBox="0 0 1361 609" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
      <!-- Generator: Sketch 46.2 (44496) - http://www.bohemiancoding.com/sketch -->
      <title>Group 21</title>
      <desc>Created with Sketch.</desc>
      <defs></defs>
      <g id="Ant-Design-Pro-3.0" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
          <g id="账户密码登录-校验" transform="translate(-79.000000, -82.000000)">
              <g id="Group-21" transform="translate(77.000000, 73.000000)">
                  <g id="Group-18" opacity="0.8" transform="translate(74.901416, 569.699158) rotate(-7.000000) translate(-74.901416, -569.699158) translate(4.901416, 525.199158)">
                      <ellipse id="Oval-11" fill="#CFDAE6" opacity="0.25" cx="63.5748792" cy="32.468367" rx="21.7830479" ry="21.766008"></ellipse>
                      <ellipse id="Oval-3" fill="#CFDAE6" opacity="0.599999964" cx="5.98746479" cy="13.8668601" rx="5.2173913" ry="5.21330997"></ellipse>
                      <path d="M38.1354514,88.3520215 C43.8984227,88.3520215 48.570234,83.6838647 48.570234,77.9254015 C48.570234,72.1669383 43.8984227,67.4987816 38.1354514,67.4987816 C32.3724801,67.4987816 27.7006688,72.1669383 27.7006688,77.9254015 C27.7006688,83.6838647 32.3724801,88.3520215 38.1354514,88.3520215 Z" id="Oval-3-Copy" fill="#CFDAE6" opacity="0.45"></path>
                      <path d="M64.2775582,33.1704963 L119.185836,16.5654915" id="Path-12" stroke="#CFDAE6" stroke-width="1.73913043" stroke-linecap="round" stroke-linejoin="round"></path>
                      <path d="M42.1431708,26.5002681 L7.71190162,14.5640702" id="Path-16" stroke="#E0B4B7" stroke-width="0.702678964" opacity="0.7" stroke-linecap="round" stroke-linejoin="round" stroke-dasharray="1.405357899873153,2.108036953469981"></path>
                      <path d="M63.9262187,33.521561 L43.6721326,69.3250951" id="Path-15" stroke="#BACAD9" stroke-width="0.702678964" stroke-linecap="round" stroke-linejoin="round" stroke-dasharray="1.405357899873153,2.108036953469981"></path>
                      <g id="Group-17" transform="translate(126.850922, 13.543654) rotate(30.000000) translate(-126.850922, -13.543654) translate(117.285705, 4.381889)" fill="#CFDAE6">
                          <ellipse id="Oval-4" opacity="0.45" cx="9.13482653" cy="9.12768076" rx="9.13482653" ry="9.12768076"></ellipse>
                          <path d="M18.2696531,18.2553615 C18.2696531,13.2142826 14.1798519,9.12768076 9.13482653,9.12768076 C4.08980114,9.12768076 0,13.2142826 0,18.2553615 L18.2696531,18.2553615 Z" id="Oval-4" transform="translate(9.134827, 13.691521) scale(-1, -1) translate(-9.134827, -13.691521) "></path>
                      </g>
                  </g>
                  <g id="Group-14" transform="translate(216.294700, 123.725600) rotate(-5.000000) translate(-216.294700, -123.725600) translate(106.294700, 35.225600)">
                      <ellipse id="Oval-2" fill="#CFDAE6" opacity="0.25" cx="29.1176471" cy="29.1402439" rx="29.1176471" ry="29.1402439"></ellipse>
                      <ellipse id="Oval-2" fill="#CFDAE6" opacity="0.3" cx="29.1176471" cy="29.1402439" rx="21.5686275" ry="21.5853659"></ellipse>
                      <ellipse id="Oval-2-Copy" stroke="#CFDAE6" opacity="0.4" cx="179.019608" cy="138.146341" rx="23.7254902" ry="23.7439024"></ellipse>
                      <ellipse id="Oval-2" fill="#BACAD9" opacity="0.5" cx="29.1176471" cy="29.1402439" rx="10.7843137" ry="10.7926829"></ellipse>
                      <path d="M29.1176471,39.9329268 L29.1176471,18.347561 C23.1616351,18.347561 18.3333333,23.1796097 18.3333333,29.1402439 C18.3333333,35.1008781 23.1616351,39.9329268 29.1176471,39.9329268 Z" id="Oval-2" fill="#BACAD9"></path>
                      <g id="Group-9" opacity="0.45" transform="translate(172.000000, 131.000000)" fill="#E6A1A6">
                          <ellipse id="Oval-2-Copy-2" cx="7.01960784" cy="7.14634146" rx="6.47058824" ry="6.47560976"></ellipse>
                          <path d="M0.549019608,13.6219512 C4.12262681,13.6219512 7.01960784,10.722722 7.01960784,7.14634146 C7.01960784,3.56996095 4.12262681,0.670731707 0.549019608,0.670731707 L0.549019608,13.6219512 Z" id="Oval-2-Copy-2" transform="translate(3.784314, 7.146341) scale(-1, 1) translate(-3.784314, -7.146341) "></path>
                      </g>
                      <ellipse id="Oval-10" fill="#CFDAE6" cx="218.382353" cy="138.685976" rx="1.61764706" ry="1.61890244"></ellipse>
                      <ellipse id="Oval-10-Copy-2" fill="#E0B4B7" opacity="0.35" cx="179.558824" cy="175.381098" rx="1.61764706" ry="1.61890244"></ellipse>
                      <ellipse id="Oval-10-Copy" fill="#E0B4B7" opacity="0.35" cx="180.098039" cy="102.530488" rx="2.15686275" ry="2.15853659"></ellipse>
                      <path d="M28.9985381,29.9671598 L171.151018,132.876024" id="Path-11" stroke="#CFDAE6" opacity="0.8"></path>
                  </g>
                  <g id="Group-10" opacity="0.799999952" transform="translate(1054.100635, 36.659317) rotate(-11.000000) translate(-1054.100635, -36.659317) translate(1026.600635, 4.659317)">
                      <ellipse id="Oval-7" stroke="#CFDAE6" stroke-width="0.941176471" cx="43.8135593" cy="32" rx="11.1864407" ry="11.2941176"></ellipse>
                      <g id="Group-12" transform="translate(34.596774, 23.111111)" fill="#BACAD9">
                          <ellipse id="Oval-7" opacity="0.45" cx="9.18534718" cy="8.88888889" rx="8.47457627" ry="8.55614973"></ellipse>
                          <path d="M9.18534718,17.4450386 C13.8657264,17.4450386 17.6599235,13.6143199 17.6599235,8.88888889 C17.6599235,4.16345787 13.8657264,0.332739156 9.18534718,0.332739156 L9.18534718,17.4450386 Z" id="Oval-7"></path>
                      </g>
                      <path d="M34.6597385,24.809694 L5.71666084,4.76878945" id="Path-2" stroke="#CFDAE6" stroke-width="0.941176471"></path>
                      <ellipse id="Oval" stroke="#CFDAE6" stroke-width="0.941176471" cx="3.26271186" cy="3.29411765" rx="3.26271186" ry="3.29411765"></ellipse>
                      <ellipse id="Oval-Copy" fill="#F7E1AD" cx="2.79661017" cy="61.1764706" rx="2.79661017" ry="2.82352941"></ellipse>
                      <path d="M34.6312443,39.2922712 L5.06366663,59.785082" id="Path-10" stroke="#CFDAE6" stroke-width="0.941176471"></path>
                  </g>
                  <g id="Group-19" opacity="0.33" transform="translate(1282.537219, 446.502867) rotate(-10.000000) translate(-1282.537219, -446.502867) translate(1142.537219, 327.502867)">
                      <g id="Group-17" transform="translate(141.333539, 104.502742) rotate(275.000000) translate(-141.333539, -104.502742) translate(129.333539, 92.502742)" fill="#BACAD9">
                          <circle id="Oval-4" opacity="0.45" cx="11.6666667" cy="11.6666667" r="11.6666667"></circle>
                          <path d="M23.3333333,23.3333333 C23.3333333,16.8900113 18.1099887,11.6666667 11.6666667,11.6666667 C5.22334459,11.6666667 0,16.8900113 0,23.3333333 L23.3333333,23.3333333 Z" id="Oval-4" transform="translate(11.666667, 17.500000) scale(-1, -1) translate(-11.666667, -17.500000) "></path>
                      </g>
                      <circle id="Oval-5-Copy-6" fill="#CFDAE6" cx="201.833333" cy="87.5" r="5.83333333"></circle>
                      <path d="M143.5,88.8126685 L155.070501,17.6038544" id="Path-17" stroke="#BACAD9" stroke-width="1.16666667"></path>
                      <path d="M17.5,37.3333333 L127.466252,97.6449735" id="Path-18" stroke="#BACAD9" stroke-width="1.16666667"></path>
                      <polyline id="Path-19" stroke="#CFDAE6" stroke-width="1.16666667" points="143.902597 120.302281 174.935455 231.571342 38.5 147.510847 126.366941 110.833333"></polyline>
                      <path d="M159.833333,99.7453842 L195.416667,89.25" id="Path-20" stroke="#E0B4B7" stroke-width="1.16666667" opacity="0.6"></path>
                      <path d="M205.333333,82.1372105 L238.719406,36.1666667" id="Path-24" stroke="#BACAD9" stroke-width="1.16666667"></path>
                      <path d="M266.723424,132.231988 L207.083333,90.4166667" id="Path-25" stroke="#CFDAE6" stroke-width="1.16666667"></path>
                      <circle id="Oval-5" fill="#C1D1E0" cx="156.916667" cy="8.75" r="8.75"></circle>
                      <circle id="Oval-5-Copy-3" fill="#C1D1E0" cx="39.0833333" cy="148.75" r="5.25"></circle>
                      <circle id="Oval-5-Copy-2" fill-opacity="0.6" fill="#D1DEED" cx="8.75" cy="33.25" r="8.75"></circle>
                      <circle id="Oval-5-Copy-4" fill-opacity="0.6" fill="#D1DEED" cx="243.833333" cy="30.3333333" r="5.83333333"></circle>
                      <circle id="Oval-5-Copy-5" fill="#E0B4B7" cx="175.583333" cy="232.75" r="5.25"></circle>
                  </g>
              </g>
          </g>
      </g>
    </svg>
    <div class="login-content">
      <!-- 登录 -->
      <div v-if="isLogin">
        <div class="loginInner">
          <el-form 
            :model="loginForm" 
            :inline="true" 
            :rules="rules" 
            ref="loginForm" 
            label-width="100px">
            <div class="type-tabs">
              <span @click="scanCodeLogin" :class="{'active':loginType==='scanCode'}">扫码登录</span>
              <span @click="accountLogin" :class="{'active':loginType==='account'}">密码登录</span>
              <span @click="telephoneLogin" :class="{'active':loginType==='telephone'}">验证码登录</span>
            </div>
            <div v-if="loginType==='scanCode'">
              <img width="200px" src="../../images/qrcode.png" alt="">
              <p class="tac">打开微信，扫一扫登录</p>
            </div>
            <div v-if="loginType==='account'">
              <el-form-item label="账号" prop="username">
                <el-input v-model.trim="loginForm.username" class="labelItem" placeholder="注册时填写的手机号"></el-input>
              </el-form-item>
              <el-form-item label="密码" prop="password">
                <el-input show-password v-model.trim="loginForm.password" class="labelItem" placeholder="请输入登录密码"></el-input>
              </el-form-item>
            </div>
            <div v-if="loginType==='telephone'">
              <el-form-item label="手机号" prop="telephone">
                <el-input v-model.trim="loginForm.telephone" class="labelItem" placeholder="注册时填写的手机号"></el-input>
              </el-form-item>
              <el-form-item label="短信验证码" prop="code">
                <el-input v-model.trim="loginForm.code" class="code labelItem" placeholder="请输入短信验证码"></el-input>
                <el-button class="fr" @click.prevent="getVertidateCode" :disabled="isDisabled" v-if="!send">获取验证码</el-button>
                <el-button class="fr" disabled v-else>{{getCode}}</el-button>
              </el-form-item>
            </div>
          </el-form>
        </div>
        <div class="login-btn">
          <div v-if="loginType !== 'scanCode'">
            <div class="forget" v-if="loginType === 'account'" @click="
              isLogin = false
              title = '忘记密码'
            "
            >忘记密码</div>
            <el-button
              type="primary" 
              style="width:100%;"
              :loading="loading" 
              @click="submitForm('loginForm')">
              登录
            </el-button>
          </div>
        </div>
        <p class="to-registered">还没有账号，
          <span @click="
            isLogin = false
            title = '注册'
          "
          >去注册 →</span>
        </p>
      </div>
      <!-- 注册 -->
      <div v-else>
        <div>{{title}}</div>
        <el-form 
            :model="registeredForm" 
            :inline="true" 
            :rules="rules" 
            ref="registeredForm" 
            label-width="100px">
            <el-form-item label="手机号" prop="telephone">
              <el-input v-model.trim="registeredForm.telephone" class="labelItem" placeholder="注册时填写的手机号"></el-input>
            </el-form-item>
            <el-form-item label="验证码" prop="code">
              <el-input v-model.trim="registeredForm.code" class="code labelItem" placeholder="请输入短信验证码"></el-input>
              <el-button class="fr" @click.prevent="getVertidateCode" :disabled="isDisabled" v-if="!send">获取验证码</el-button>
              <el-button class="fr" disabled v-else>{{getCode}}</el-button>
            </el-form-item>
            <el-form-item label="密码" prop="password">
              <el-input show-password v-model.trim="registeredForm.password" class="labelItem" placeholder="8-16位必须包含数字和字母"></el-input>
            </el-form-item>
            <el-form-item label="手机号" prop="confirmPassword">
              <el-input show-password v-model.trim="registeredForm.confirmPassword" class="labelItem" placeholder="请再次输入密码"></el-input>
            </el-form-item>
            <div v-if="title==='注册'">
              <el-button
                type="success" 
                style="width:100%;"
                :loading="loading" 
                @click="submitForm('loginForm')">
                注册
              </el-button>
              <p class="to-login">有账号，
                <span @click="
                  isLogin = true
                "
                >去登录 →</span>
              </p>
              <div>
                <el-checkbox>注册表示同意<span>《用户服务协议》</span></el-checkbox>
              </div>
            </div>
            <div v-if="title==='忘记密码'">
              <el-button @click="
                isLogin = true
              "
              >取消</el-button>
              <el-button type="success">确认</el-button>
            </div>
          </el-form>
      </div>
    </div>
  </div>
</template>

<script>
import storage from "good-storage"
import { setCookie, getCookie, delCookie } from '@/utils/index'
export default {
  name: 'Login',
  data () {
    let checkTel = (rule, value, callback) => {
      let reg=/^[1](([3][0-9])|([4][5-9])|([5][0-3,5-9])|([6][5,6])|([7][0-8])|([8][0-9])|([9][1,8,9]))[0-9]{8}$/
      this.isDisabled=true
      if(value){
         if (!reg.test(value)) {
            return callback(new Error('请输入正确的手机号！'));
          }else{
            this.isDisabled=false
            callback()
          }
      }else{
        callback(new Error('请输入手机号！'))
      }
    };  
    return {
      isLogin:true,
      title:'注册',
      isDisabled: true,
      checkedUser: false,
      getCode: '获取验证码',
      // 是否已发送验证码
      send:false,
      loading:false,
      time:59,
      timer:null,
      ticket:null,
      loginForm: {
        username: '',
        password: null,
        telephone:null,
        code:null,
      },
      registeredForm: {
        telephone:null,
        code:null,
        confirmPassword: null,
        password: null,
      },
      rules: {
        username: [
          { required: true, message: '请输入用户名', trigger: 'blur' },
          { min: 1, max: 30, message: "用户名长度在5到30个字符", trigger: "blur" }
        ],
        password: [
          {required: true, message: '请输入密码', trigger: 'blur'},
          { min: 6, max: 12, message: "密码长度在6到12个字符", trigger: "blur" }
        ],
        telephone:[
          { validator:checkTel,required: true,trigger: 'blur' },
        ],
        code:[
          {required: true, message: '请输入验证码', trigger: 'blur'},
        ]
      },
      loginType:'account',
      // 历史页面地址
      historyPath:null
    }
  },
  created() {
  },
  beforeRouteEnter (to, from, next) {
    // 存储来源页，登陆成功之后跳转回来源页
    next(vm=>{
      vm.historyPath=from.fullPath
    })
  },
  watch:{
    loginType(){
      this.$nextTick(()=>{
        this.$refs.loginForm.resetFields()
      })
    },
    time(n){
      if(!n){
        this.send=false
        clearInterval(this.timer)
        this.time=59
      }
    }
  },
  mounted() {
    document.onkeydown=()=> {
      var key=window.event.keyCode
      if(key===13){
        this.submitForm()
      }
    }
  },
  methods: {
    scanCodeLogin(){
      this.loginType='scanCode'
    },
    accountLogin(){
      this.loginType='account'
    },
    telephoneLogin(){
      this.loginType='telephone'
    },
    getVertidateCode(){
      this.$ajax.getCode(this.loginForm.telephone).then(res=>{
        console.log(res)
        if(res.result){
          this.send=true
          this.ticket=res.data.ticket
          this.timer=setInterval(()=>{
            this.time--
            this.getCode=`${this.time}s后获取`
          },1000)
        }
      })
    },
    changeForget(){
      
    },
    submitForm(formName) {
      this.$refs.loginForm.validate(valid=>{
        if(valid){
          this.$router.push('/home')

          // this.loading=true
          // if(this.loginType==='account'){
          //   let data={
          //     password:this.loginForm.password,
          //     username:this.loginForm.username
          //   }
          //   this.$ajax.login(data).then(res=>{
          //     console.log(res)
          //     this.loading=false
          //     if(res.result){
          //       setCookie('token',res.data.token)
          //       storage.set('userInfo',res.data)
          //       console.log(this.historyPath)
          //       if(this.historyPath&&this.historyPath!=='/'){
          //         this.$router.push({
          //           path:this.historyPath
          //         });
          //       }else{
          //         this.$router.push('/index');
          //       }
          //     }else{
          //       this.$message({
          //         type:'error',
          //         message:res.message.globel
          //       })
          //     }
          //   }).catch(()=>{
          //     this.loading=false
          //   })
          // }else{
          //   let data={
          //     code:this.loginForm.code,
          //     telephone:this.loginForm.telephone,
          //     ticket:this.ticket
          //   }
          //   if(!this.ticket){
          //     this.$message({
          //       type:'warning',
          //       message:'请先获取验证码！'
          //     })
          //   }
          //   this.$ajax.mobileLogin(data).then(res=>{
          //     console.log(res)
          //     this.loading=false
          //     if(res.result){
          //       setCookie('token',res.data.token)
          //       storage.set('userInfo',res.data)
          //       console.log(this.historyPath)
          //       if(this.historyPath){
          //         this.$router.push({
          //           path:this.historyPath
          //         });
          //       }else{
          //         this.$router.push('/index');
          //       }
          //     }else{
          //       this.$message({
          //         type:'error',
          //         message:res.message.globel
          //       })
          //     }
          //   }).catch(()=>{
          //     this.loading=false
          //   })
          // }
        }else{
          return false
        }
      })
    }
  }
}
</script>

<style lang="less" scoped>
.login-wrap{
  position: relative;
  font-size: 12px;
  color: #333;
  .login-top{
    position: absolute;
    left: 20px;
    top: 30px;
    .logo{

    }
    .title{

    }
  }
  .login-content{
    position: absolute;
    left: 0;
    right: 0;
    top: 0;
    bottom: 0;
    margin: auto;
    width: 330px;
    height: 380px;
    background: #fff;
    border-radius:10px;
    padding: 20px;
    box-shadow: 2px 2px 9px 0px rgba(236, 236, 236, 1);
    .loginInner{
      .type-tabs{
        line-height: 80px;
        font-size: 14px;
        color: #2F93FF;
        display: flex;
        justify-content: center;
        align-items: center;
        span{
          cursor: pointer;
          display: inline-block;
          flex-grow: 1/3;
        }
      }
      .active{
        color: orange;
        font-size: 20px;
      }
    }
    .registered{
      
    }
    .login-btn{
      .forget{
        cursor: pointer;
        text-align: right;
        line-height: 50px;
      }
    }
    .labelItem{
      border-bottom:1px solid #f1f1f1;
      color:#666;
      font-size: 14px;
    }
    .to-registered{
      position: absolute;
      left: 0;
      bottom: 0;
      line-height: 40px;
      display: flex;
      width: 100%;
      justify-content: center;
      align-items: center;
      span{
        cursor: pointer;
        color: orange;
      }
    }
    .to-login{
      margin: 20px 0;
      span{
        cursor: pointer;
        color: orange;
      }
    }
  }
}
</style>
<style lang="less">
.login-wrap{
  .el-input__inner{
    border:none;
    width: 220px;
  }
  .code{
    width:100px;
    .el-input__inner{
      width: 100px;
    }
  }
}
</style>